(function(D){typeof define=="function"&&define.amd?define(D):D()})(function(){"use strict";const D='<img src="/img/load.gif" class="mx-auto d-block" height="75px">';let M=!1;function U(){if($("#compare-data").length||$("#report-data").length){let T=function(a){return"rgba("+parseInt(a.slice(-6,-4),16)+","+parseInt(a.slice(-4,-2),16)+","+parseInt(a.slice(-2),16)+",0.4)"},E=function(a){const s=T("#2d2d2d");return{background:a,background:"-moz-linear-gradient(90deg, "+a+" 0%, "+s+" 100%)",background:"-webkit-linear-gradient(90deg, "+a+" 0%, "+s+" 100%)",background:"linear-gradient(90deg, "+a+" 0%, "+s+" 100%)"}},y=function(a,s,u){let f=!0;for(let g=0;g<s.length;g++){const v=s[g];if(f){const C=$("pre[data-file-id='"+a+"']").find("[data-range='"+v+"']"),e=parseInt(C.css("top"),10);$("#id-"+a).find(".line-numbers").scrollTop(e);const o=C.offset();o!=null&&$("#report-match-info").css("margin-top",o.top-$('[data-js="comparison"]').offset().top),f=!1}$("pre[data-file-id='"+a+"']").find("[data-range='"+v+"']").css(E(T(u)))}},j=function(a){x=!0;let s;c>=0&&(s=$("#row-"+c),s.removeClass("active"),s.find("[data-js='match-show']").removeClass("d-none"),s.find("[data-js='match-hide']").addClass("d-none")),c=a;const u=t[c];if(u==null){F();return}let f=$("#match-info"),g=!0;if(f.length||(f=$("#report-match-info"),g=!1),f.find("#match-reason").text("#"+a+": "+u.reason),f.find("#match-score").text(u.score),f.find(".match-colour").css("background-color",u.colour),!g){b=!0,f.find("#match-code").html("");for(let C=0;C<u.matches.length;C++){const e=u.matches[C];e.submission!==l&&f.find("#match-code").append('<div class="card-header">'+e.submissionName+": "+e.displayName+`</div><pre class="line-numbers mt-0" style="height: 300px; resize: vertical"
data-line="`+e.lines+`"
data-src="/dashboard/workspaces/manage/`+i+"/submission/"+e.submission+"/file/"+e.id+"/"+e.name+'"></pre>')}Prism.fileHighlight()}f.show(),s=$("#row-"+c),s.addClass("active"),s.find("[data-js='match-show']").addClass("d-none"),s.find("[data-js='match-hide']").removeClass("d-none"),$(".line-highlight").each(function(){$(this).css("background","")}),$(".collapse").removeClass("show");for(let C=0;C<u.matches.length;C++){const e=u.matches[C];$("#id-"+e.id).addClass("show"),y(e.id,e.lines,u.colour)}let v;g?(v=$("[data-js='comparison']").offset().top,$("#matches-container").hasClass("sticky-top")&&(v-=$("#matches-container").height())):(v=$("#report-match-info").offset().top-10,$("#matches-container").hasClass("sticky-top")&&(v-=$("#matches-container").height())),$("html, body").scrollTop(v),x=!1},F=function(){if(c>=0){const a=$("#row-"+c);a.removeClass("active"),a.find("[data-js='match-show']").removeClass("d-none"),a.find("[data-js='match-hide']").addClass("d-none")}$("#match-info").slideUp(),$("#report-match-info").slideUp(),$(".line-highlight").each(function(){const a=$(this),s=a.attr("data-range"),u=a.closest("pre").attr("data-file-id");if(u==null)return;const f=n[u].visible[s];if(f!=null){const g=t[f];g!=null&&a.css(E(T(g.colour)))}}),c=-1},L=function(){$("#match-info").hide(),$("#report-match-info").hide(),$("[data-js='match-previous']").unbind(),$("[data-js='match-previous']").click(function(a){let s=parseInt(c,10)-1;s<0&&(s=Object.keys(t).length-1),j(s)}),$("[data-js='match-next']").unbind(),$("[data-js='match-next']").click(function(a){let s=parseInt(c,10)+1;s>=Object.keys(t).length&&(s=0),j(s)}),$("[data-js='match-show']").unbind(),$("[data-js='match-show']").click(function(a){const s=$(this);j(s.attr("data-js-target"))}),$("[data-js='match-hide']").unbind(),$("[data-js='match-hide']").click(function(a){F()}),$("[data-js='matches-left']").unbind(),$("[data-js='matches-left']").click(function(a){$("#left").addClass("col-lg-9"),$("#left").removeClass("col-lg-6"),$("#left").removeClass("col-lg-3"),$("#right").addClass("col-lg-3"),$("#right").removeClass("col-lg-6"),$("#right").removeClass("col-lg-9"),$("[data-js='matches-left']").addClass("d-none"),$("[data-js='matches-right']").removeClass("d-none"),$(".restore-left").removeClass("d-none"),$(".restore-right").addClass("d-none")}),$("[data-js='matches-right']").unbind(),$("[data-js='matches-right']").click(function(a){$("#right").addClass("col-lg-9"),$("#right").removeClass("col-lg-6"),$("#right").removeClass("col-lg-3"),$("#left").addClass("col-lg-3"),$("#left").removeClass("col-lg-6"),$("#left").removeClass("col-lg-9"),$("[data-js='matches-left']").removeClass("d-none"),$("[data-js='matches-right']").addClass("d-none"),$(".restore-left").addClass("d-none"),$(".restore-right").removeClass("d-none")}),$("[data-js='matches-restore']").unbind(),$("[data-js='matches-restore']").click(function(a){$("#left").addClass("col-lg-6"),$("#left").removeClass("col-lg-9"),$("#left").removeClass("col-lg-3"),$("#right").addClass("col-lg-6"),$("#right").removeClass("col-lg-3"),$("#right").removeClass("col-lg-9"),$("[data-js='matches-left']").removeClass("d-none"),$("[data-js='matches-right']").removeClass("d-none"),$(".restore-left").addClass("d-none"),$(".restore-right").addClass("d-none")}),$("[data-js='matches-list']").unbind(),$("[data-js='matches-list']").click(function(a){$("[data-js='matches-list']").each(function(s){$(this).toggleClass("d-none")}),$("#matches-table-container").toggleClass("d-none")}),$(".accordion").on("hide.bs.collapse",function(){x===!1&&F()}),$(".accordion").on("show.bs.collapse",function(){x===!1&&F()})},S=function(){if(isPrinting()){p=0,$("pre").each(function(){$(this).html().includes("âœ– Error")&&p++});const a=w/$("pre").length*100;$("#loaded-progress").css("width",a+"%");const s=p/$("pre").length*100;$("#failed-progress").css("width",s+"%"),w+p>=$("pre").length&&k===!1&&(k=!0,setTimeout(function(){$("#print").removeClass("d-none"),p!==0&&alert("Some of the files may have failed to load. Please print the report to PDF, or use the print preview, to check that all the files have loaded successfully."),window.print()},1e3))}};const t=getMatchesJSON(),n=getMapJSON();let i=0,l=0;$("#report-data").length&&(i=getWorkspaceId(),l=getSubmissionId());let c=-1,w=0,p=0,x=!1,k=!1,b=!1;Prism.hooks.add("complete",function(){if(b){const a=$("#report-match-info");if(a.length){let s=!0;a.find(".line-highlight").each(function(u){const f=$(this);if(f.css(E(T("#f47b2a"))),s){const g=f.position();g!=null&&a.find(".line-numbers").scrollTop(g.top),s=!1}})}}else $("#match-info").length&&($(".code-toolbar").unbind(),$(".code-toolbar").click(function(a){F()})),F(),w++,S();$(".line-highlight").unbind(),$(".line-highlight").click(function(a){if(c<0){const s=$(this),u=s.attr("data-range"),f=s.closest("pre").attr("data-file-id"),g=n[f].visible[u];g!=null&&j(g),a.stopPropagation()}})}),L()}}function I(t){A(t.attr("data-js-href"),function(n,i,l){t.html(n)},t)}function _(){$("[data-js='area']").each(function(){const t=$(this);t.attr("data-js","area-loaded"),I(t)})}function G(){$("[data-js='triggerArea']").each(function(){const t=$(this),n=t.attr("data-js-target");t.remove(),$(n).html(D),I($(n))})}function H(){$("[data-js='triggerAreaLink']").unbind(),$("[data-js='triggerAreaLink']").click(function(){const n=$(this).attr("data-js-target");$(n).html(D),I($(n)),$("#modal").modal("hide")})}function P(){$("select[data-js='select']").unbind(),$("select[data-js='select']").on("change",function(){const t=$(this),n=t.val(),i=t.attr("data-js-target"),l=t.attr("data-js-href");return $(i).html(D),A(l+n,function(c,w,p){$(i).html(c)},i),!1})}function q(){$("[data-js='radio-div']").unbind(),$("[data-js='radio-div']").on("change",function(){const t=$(this),n=t.val(),i=t.attr("name");return $("."+i+":not(#"+n+")").slideUp(),$("#"+n).slideDown(),Cookies.set("radio_"+i,n),!1}),$("[data-js='radio-div']").each(function(){const n=$(this).attr("name"),i=Cookies.get("radio_"+n);console.log(n,i);let l=!1;i!=null&&(l=!0),$('input:radio[name="'+n+'"][value="'+i+'"]').attr("checked",l).trigger("change"),$("."+n).removeClass("d-none"),$("."+n).hide()})}function B(){$("[data-js='triggerNameChange']").each(function(){$(this).remove();const n=$("#username").val();$("#account-username").text(n)})}function J(){$("[data-js='modal']").unbind(),$("[data-js='modal']").click(function(){const t=$(this),n=t.attr("href");return t.prop("disabled",!0),t.addClass("disabled"),A(n,function(i,l,c){$("#modal").html(i),$("#modal").modal("show"),P()},$("#modal")),t.prop("disabled",!1),t.removeClass("disabled"),!1})}function W(){if($("[data-js='networkArea']").length){let L=function(e,o){const r=e.label.toLowerCase(),d=o.label.toLowerCase();return r<d?-1:r>d?1:0},S=function(e){const o=$.grep(j.nodes,function(r,d){return r.id===e});if(o.length===1){const r=o[0];try{k.add({id:r.id,label:r.label,color:p[r.group]})}catch{}}},a=function(e,o){const r=$.grep(j.matches,function(N,Z){return N.to===e&&N.from===o}),d=$.grep(j.matches,function(N,Z){return N.to===o&&N.from===e}),h=$.merge(r,d),m=h[0];h.length>1&&m.score<h[1].score&&h[1];const Y=Math.min(m.to,m.from)+"_"+Math.max(m.to,m.from);try{b.add({id:Y,from:m.from,to:m.to,color:p[m.group]})}catch{}},s=function(e){const o=$.grep(j.matches,function(h,m){return h.to===e}),r=$.grep(j.matches,function(h,m){return h.from===e}),d=$.merge(o,r);for(let h=0;h<d.length;h++){const m=d[h];a(m.to,m.from)}},u=function(e){const o=$.grep(j.matches,function(d,h){return d.to===e});for(let d=0;d<o.length;d++){const h=o[d];a(h.to,h.from)}const r=$.grep(j.matches,function(d,h){return d.from===e});for(let d=0;d<r.length;d++){const h=r[d];S(h.to),a(h.to,h.from)}v()},f=function(){const e=$("[data-js='edgeDelete']"),o=$("[data-js='nodeDelete']"),r=$("[data-js='nodeMatches']");y.getSelectedEdges().length===0?(e.prop("disabled",!0),e.addClass("disabled")):(e.prop("disabled",!1),e.removeClass("disabled")),y.getSelectedNodes().length===0?(o.prop("disabled",!0),o.addClass("disabled"),r.prop("disabled",!0),r.addClass("disabled")):(o.prop("disabled",!1),o.removeClass("disabled"),r.prop("disabled",!1),r.removeClass("disabled"))},g=function(){$("[data-js='submissionAdd']").unbind(),$("[data-js='submissionAdd']").click(function(){const o=$(this).attr("data-js-target");S(o),s(o),v()}),$("[data-js='submissionMatches']").unbind(),$("[data-js='submissionMatches']").click(function(){const o=$(this).attr("data-js-target");u(o)}),$("[data-js='submissionDelete']").unbind(),$("[data-js='submissionDelete']").click(function(){const o=$(this).attr("data-js-target");k.remove({id:o}),v()})},v=function(){t.html(""),l.html("");let e=0,o=0;for(let r=0;r<j.nodes.length;r++){const d=j.nodes[r];if(k.get(d.id)==null){const m=c.clone();m.find(".js-label").text(d.label),m.find(".js-id").attr("data-js-target",d.id),l.append(m.html()),o++}else{const m=n.clone();m.find(".js-label").text(d.label),m.find(".js-id").attr("data-js-target",d.id),t.append(m.html()),e++}}e===0&&t.html(i.html()),o===0&&l.html(w.html()),g(),f()};const t=$("#network-included"),n=$("#network-included-template"),i=$("#network-included-template-empty"),l=$("#network-excluded"),c=$("#network-excluded-template"),w=$("#network-excluded-template-empty"),p={0:"#00FF00",1:"#8DFF00",2:"#8DFF00",3:"#E5FF00",4:"#FFF600",5:"#FFE400",6:"#FFAF00",7:"#FF9E00",8:"#FF7B00",9:"#FF5700"},x=document.getElementById("network-graph"),k=new vis.DataSet,b=new vis.DataSet,T={nodes:k,edges:b},E={},y=new vis.Network(x,T,E),j=graphData();j.nodes.sort(L);let F="";y.on("click",function(e){f()}),y.on("afterDrawing",function(e){F=e.canvas.toDataURL()}),$("[data-js='edgeDelete']").click(function(){$(this).blur();const e=y.getSelectedEdges();for(let o in e)b.remove(e[o]);v()}),$("[data-js='nodeDelete']").click(function(){$(this).blur();const e=y.getSelectedNodes();for(let o in e)k.remove(e[o]);v()}),$("[data-js='nodeMatches']").click(function(){$(this).blur();const e=y.getSelectedNodes();for(let o in e)u(e[o])}),$("[data-js='graphDownload']").click(function(){const e=$(this);e.blur(),e.attr("href",F)}),v();const C=X("start");C.length>0&&(S(C),u(C))}}function z(){$("[data-js='form']").unbind(),$("[data-js='form']").submit(function(){const t=$(this),n=t.attr("action"),i=$(t.attr("data-js-target"));t.find("button[type=submit]").prop("disabled",!0),t.find("button[type=submit]").addClass("disabled");const l=new FormData(this);return l.append("ajax","true"),R(n,l,function(c,w,p){i.html(c)},"POST",i),!1})}function V(){$(".js-cancel").each(function(){$(this).closest("#modal-container").length===1&&($(this).is("button")?$(this).removeClass("d-none"):$(this).is("a")&&$(this).hide())})}function K(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover()}function Q(){$.fn.dataTable.ext.errMode="throw",$('[data-js="table"]').dataTable({paging:!0,pagingType:"simple_numbers",bLengthChange:!1,bInfo:!1,searching:!0,autoWidth:!1,language:{search:'<div class="input-group"><div class="input-group-prepend"><span class="input-group-text oi oi-magnifying-glass"></span></div>'}}),$("[data-js='table']").each(function(){$(this).attr("data-js","table-loaded")}),$('[data-js="table-matches"]').dataTable({paging:!1,bInfo:!1,searching:!0,autoWidth:!1,language:{search:'<div class="input-group"><div class="input-group-prepend"><span class="input-group-text oi oi-magnifying-glass"></span></div>'},columnDefs:[{orderData:[2],targets:3},{orderable:!1,targets:[4]}]}),$("[data-js='table-matches']").each(function(){$(this).attr("data-js","table-loaded")}),$(".dataTables_filter").each(function(){const t=$(this).parent();t.removeClass("col-md-6"),t.addClass("col-md-12")})}function X(t){const i=window.location.search.substring(1).split("&");for(let l=0;l<i.length;l++){const c=i[l].split("=");if(c[0]===t)return c[1]}return""}function A(t,n,i){R(t,{ajax:"true"},n,"GET",i)}function R(t,n,i,l,c){const w={type:l,accept:"text/html",dataType:"html",url:t,timeout:3e4,data:n,success:function(p,x,k){k.getResponseHeader("sherlock-url")!==t||p.includes("<link ")?window.location=k.getResponseHeader("sherlock-url"):i(p,x,k),O()},error:function(p,x,k){const b=$("#javascript-error-clone").clone();b.find("."+p.status).length===1?b.find(".alert").html(b.find("."+p.status).html()):(b.find(".alert").html(b.find(".other").html()),b.find(".status-code").text(p.status)),c.attr("id")==="modal"||$("#modal").find(c).length===1?($("#modal").modal("hide"),$("#javascript-error").html(b.html())):c.html(b.html())}};l==="POST"&&$.extend(w,{cache:!1,contentType:!1,processData:!1}),$.ajax(w)}function O(){V(),_(),G(),K(),P(),J(),z(),H(),B(),q(),Q()}$(function(){$('form[data-js="autoSubmit"]').submit(),O(),U(),$(window).focus(function(){M===!1&&($("[data-js='match-hide']").trigger("click"),M=!0)}),W();const t=window.location.toString();let n=t;if(t.indexOf("?")>0&&(n=t.substring(0,t.indexOf("?")),window.history.replaceState({},document.title,n)),$("#job-status").length&&$("#job-progress").length){const i=n+"/json";setInterval(function(){$.getJSON(i,function(l){$("#job-status").html(l.message);const c=l.progress+"%";$("#job-progress").css("width",c),$("#job-progress span").html(c),l.message==="Finished"&&location.reload()})},5e3)}$("#queue-parent").length&&setInterval(function(){A("/dashboard/index/queue",function(i,l,c){$("#queue-parent").html(i)},$("#modal"))},5e3)}),window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#4e5d6c",text:"#ffffff"},button:{background:"#df691a",text:"#ffffff"}},position:"top",static:!0,content:{href:"/privacy"}})})});
